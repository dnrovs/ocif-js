import { Color } from './types'

export const palette: number[] = [
    0x000000, 0x000040, 0x000080, 0x0000bf, 0x0000ff, 0x002400, 0x002440,
    0x002480, 0x0024bf, 0x0024ff, 0x004900, 0x004940, 0x004980, 0x0049bf,
    0x0049ff, 0x006d00, 0x006d40, 0x006d80, 0x006dbf, 0x006dff, 0x009200,
    0x009240, 0x009280, 0x0092bf, 0x0092ff, 0x00b600, 0x00b640, 0x00b680,
    0x00b6bf, 0x00b6ff, 0x00db00, 0x00db40, 0x00db80, 0x00dbbf, 0x00dbff,
    0x00ff00, 0x00ff40, 0x00ff80, 0x00ffbf, 0x00ffff, 0x0f0f0f, 0x1e1e1e,
    0x2d2d2d, 0x330000, 0x330040, 0x330080, 0x3300bf, 0x3300ff, 0x332400,
    0x332440, 0x332480, 0x3324bf, 0x3324ff, 0x334900, 0x334940, 0x334980,
    0x3349bf, 0x3349ff, 0x336d00, 0x336d40, 0x336d80, 0x336dbf, 0x336dff,
    0x339200, 0x339240, 0x339280, 0x3392bf, 0x3392ff, 0x33b600, 0x33b640,
    0x33b680, 0x33b6bf, 0x33b6ff, 0x33db00, 0x33db40, 0x33db80, 0x33dbbf,
    0x33dbff, 0x33ff00, 0x33ff40, 0x33ff80, 0x33ffbf, 0x33ffff, 0x3c3c3c,
    0x4b4b4b, 0x5a5a5a, 0x660000, 0x660040, 0x660080, 0x6600bf, 0x6600ff,
    0x662400, 0x662440, 0x662480, 0x6624bf, 0x6624ff, 0x664900, 0x664940,
    0x664980, 0x6649bf, 0x6649ff, 0x666d00, 0x666d40, 0x666d80, 0x666dbf,
    0x666dff, 0x669200, 0x669240, 0x669280, 0x6692bf, 0x6692ff, 0x66b600,
    0x66b640, 0x66b680, 0x66b6bf, 0x66b6ff, 0x66db00, 0x66db40, 0x66db80,
    0x66dbbf, 0x66dbff, 0x66ff00, 0x66ff40, 0x66ff80, 0x66ffbf, 0x66ffff,
    0x696969, 0x787878, 0x878787, 0x969696, 0x990000, 0x990040, 0x990080,
    0x9900bf, 0x9900ff, 0x992400, 0x992440, 0x992480, 0x9924bf, 0x9924ff,
    0x994900, 0x994940, 0x994980, 0x9949bf, 0x9949ff, 0x996d00, 0x996d40,
    0x996d80, 0x996dbf, 0x996dff, 0x999200, 0x999240, 0x999280, 0x9992bf,
    0x9992ff, 0x99b600, 0x99b640, 0x99b680, 0x99b6bf, 0x99b6ff, 0x99db00,
    0x99db40, 0x99db80, 0x99dbbf, 0x99dbff, 0x99ff00, 0x99ff40, 0x99ff80,
    0x99ffbf, 0x99ffff, 0xa5a5a5, 0xb4b4b4, 0xc3c3c3, 0xcc0000, 0xcc0040,
    0xcc0080, 0xcc00bf, 0xcc00ff, 0xcc2400, 0xcc2440, 0xcc2480, 0xcc24bf,
    0xcc24ff, 0xcc4900, 0xcc4940, 0xcc4980, 0xcc49bf, 0xcc49ff, 0xcc6d00,
    0xcc6d40, 0xcc6d80, 0xcc6dbf, 0xcc6dff, 0xcc9200, 0xcc9240, 0xcc9280,
    0xcc92bf, 0xcc92ff, 0xccb600, 0xccb640, 0xccb680, 0xccb6bf, 0xccb6ff,
    0xccdb00, 0xccdb40, 0xccdb80, 0xccdbbf, 0xccdbff, 0xccff00, 0xccff40,
    0xccff80, 0xccffbf, 0xccffff, 0xd2d2d2, 0xe1e1e1, 0xf0f0f0, 0xff0000,
    0xff0040, 0xff0080, 0xff00bf, 0xff00ff, 0xff2400, 0xff2440, 0xff2480,
    0xff24bf, 0xff24ff, 0xff4900, 0xff4940, 0xff4980, 0xff49bf, 0xff49ff,
    0xff6d00, 0xff6d40, 0xff6d80, 0xff6dbf, 0xff6dff, 0xff9200, 0xff9240,
    0xff9280, 0xff92bf, 0xff92ff, 0xffb600, 0xffb640, 0xffb680, 0xffb6bf,
    0xffb6ff, 0xffdb00, 0xffdb40, 0xffdb80, 0xffdbbf, 0xffdbff, 0xffff00,
    0xffff40, 0xffff80, 0xffffbf, 0xffffff
]

export function toRGB(color: number): Color {
    return {
        r: (color >> 16) & 0xff,
        g: (color >> 8) & 0xff,
        b: color & 0xff
    }
}

export function fromRGB(color: Color): number {
    return (color.r << 16) | (color.g << 8) | color.b
}

export function findClosestColor(color: number): number {
    const rgb = toRGB(color)
    let closestIndex = 0
    let minDiff = Infinity

    for (let i = 0; i < palette.length; i++) {
        const paletteRgb = toRGB(palette[i])
        const diff =
            Math.pow(rgb.r - paletteRgb.r, 2) +
            Math.pow(rgb.g - paletteRgb.g, 2) +
            Math.pow(rgb.b - paletteRgb.b, 2)

        if (diff < minDiff) {
            minDiff = diff
            closestIndex = i
        }
    }

    return closestIndex
}
